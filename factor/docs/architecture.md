# ETFå› å­åº“æ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒè¦æ±‚
- **å‘é‡åŒ–è®¡ç®—**: åŸºäºNumPy/Pandaså‘é‡åŒ–ï¼Œé¿å…å¾ªç¯
- **æ–‡ä»¶é™åˆ¶**: æ¯ä¸ªä»£ç æ–‡ä»¶ä¸è¶…è¿‡200è¡Œ
- **ç¼“å­˜æœºåˆ¶**: æ”¯æŒå¢é‡æ›´æ–°ï¼Œé¿å…é‡å¤è®¡ç®—
- **é«˜æ€§èƒ½**: æ‰¹é‡è®¡ç®—25ä¸ªå› å­ï¼Œæ”¯æŒå¤§æ•°æ®é‡
- **å¯æ‰©å±•**: è½»æ¾æ·»åŠ æ–°å› å­ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç   
- **å¯ç»´æŠ¤**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œå•ä¸€èŒè´£åŸåˆ™

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Vectorized Factor Library               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸš€ Vectorized Engine (å‘é‡åŒ–å¼•æ“)                       â”‚
â”‚  â”œâ”€â”€ NumPy/Pandas å‘é‡åŒ–è®¡ç®—                             â”‚
â”‚  â”œâ”€â”€ æ‰¹é‡å› å­è®¡ç®—ç®¡é“                                     â”‚
â”‚  â””â”€â”€ å†…å­˜ä¼˜åŒ–å¤„ç†                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ Cache Layer (ç¼“å­˜å±‚)                                 â”‚
â”‚  â”œâ”€â”€ Redis/Memory Cache: å› å­ç»“æœç¼“å­˜                    â”‚
â”‚  â”œâ”€â”€ Incremental Update: å¢é‡æ›´æ–°æœºåˆ¶                    â”‚
â”‚  â””â”€â”€ Cache Strategy: ç¼“å­˜ç­–ç•¥ç®¡ç†                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Factor Layer (å› å­å±‚)                                â”‚
â”‚  â”œâ”€â”€ Single File per Factor: æ¯å› å­ä¸€ä¸ª.pyæ–‡ä»¶(<200è¡Œ)   â”‚
â”‚  â”œâ”€â”€ Vectorized Implementation: å‘é‡åŒ–å®ç°               â”‚
â”‚  â””â”€â”€ Standardized Interface: æ ‡å‡†åŒ–æ¥å£                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Data & Utils (æ•°æ®å·¥å…·å±‚)                            â”‚
â”‚  â”œâ”€â”€ DataLoader: æ•°æ®åŠ è½½                               â”‚
â”‚  â”œâ”€â”€ Vectorized Utils: å‘é‡åŒ–å·¥å…·                        â”‚
â”‚  â””â”€â”€ Performance Monitor: æ€§èƒ½ç›‘æ§                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ ç›®å½•ç»“æ„è®¾è®¡

```
factor/
â”œâ”€â”€ src/                          # æ ¸å¿ƒæºç  (æ¯ä¸ªæ–‡ä»¶<200è¡Œ)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py                 # å‘é‡åŒ–è®¡ç®—å¼•æ“ (<200è¡Œ)
â”‚   â”œâ”€â”€ cache.py                  # ç¼“å­˜ç®¡ç†å™¨ (<200è¡Œ)
â”‚   â”œâ”€â”€ data_loader.py            # æ•°æ®åŠ è½½å™¨ (<200è¡Œ)
â”‚   â”œâ”€â”€ data_writer.py            # æ•°æ®è¾“å‡ºå™¨ (<200è¡Œ)
â”‚   â””â”€â”€ base_factor.py            # å› å­åŸºç±» (<200è¡Œ)
â”œâ”€â”€ factors/                      # å› å­å®ç° (æ¯å› å­ä¸€ä¸ª.pyæ–‡ä»¶)
â”‚   â”œâ”€â”€ __init__.py
â”‚   # ç§»åŠ¨å‡çº¿ç±» (5ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ sma.py                    # ç®€å•ç§»åŠ¨å‡çº¿ (<200è¡Œ)
â”‚   â”œâ”€â”€ ema.py                    # æŒ‡æ•°ç§»åŠ¨å‡çº¿ (<200è¡Œ)
â”‚   â”œâ”€â”€ wma.py                    # åŠ æƒç§»åŠ¨å‡çº¿ (<200è¡Œ)
â”‚   â”œâ”€â”€ ma_diff.py                # å‡çº¿å·®å€¼ (<200è¡Œ)
â”‚   â”œâ”€â”€ ma_slope.py               # å‡çº¿æ–œç‡ (<200è¡Œ)
â”‚   # è¶‹åŠ¿åŠ¨é‡ç±» (4ä¸ªæ–‡ä»¶)  
â”‚   â”œâ”€â”€ macd.py                   # MACD (<200è¡Œ)
â”‚   â”œâ”€â”€ rsi.py                    # RSI (<200è¡Œ)
â”‚   â”œâ”€â”€ roc.py                    # ROC (<200è¡Œ)
â”‚   â”œâ”€â”€ mom.py                    # åŠ¨é‡ (<200è¡Œ)
â”‚   # æ³¢åŠ¨ç‡ç±» (8ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ tr.py                     # çœŸå®æ³¢å¹… (<200è¡Œ)
â”‚   â”œâ”€â”€ atr.py                    # ATR (<200è¡Œ)
â”‚   â”œâ”€â”€ atr_pct.py                # ATRç™¾åˆ†æ¯” (<200è¡Œ)
â”‚   â”œâ”€â”€ hv.py                     # å†å²æ³¢åŠ¨ç‡ (<200è¡Œ)
â”‚   â”œâ”€â”€ boll.py                   # å¸ƒæ—å¸¦ (<200è¡Œ)
â”‚   â”œâ”€â”€ dc.py                     # å”å¥‡å®‰é€šé“ (<200è¡Œ)
â”‚   â”œâ”€â”€ bb_width.py               # å¸ƒæ—å¸¦å®½åº¦ (<200è¡Œ)
â”‚   â”œâ”€â”€ stoch.py                  # éšæœºéœ‡è¡å™¨ (<200è¡Œ)
â”‚   # é‡ä»·å…³ç³»ç±» (7ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ vma.py                    # æˆäº¤é‡å‡çº¿ (<200è¡Œ)
â”‚   â”œâ”€â”€ volume_ratio.py           # é‡æ¯” (<200è¡Œ)
â”‚   â”œâ”€â”€ obv.py                    # OBV (<200è¡Œ)
â”‚   â”œâ”€â”€ kdj.py                    # KDJ (<200è¡Œ)
â”‚   â”œâ”€â”€ cci.py                    # CCI (<200è¡Œ)
â”‚   â”œâ”€â”€ wr.py                     # WR (<200è¡Œ)
â”‚   â”œâ”€â”€ mfi.py                    # MFI (<200è¡Œ)
â”‚   # æ”¶ç›Šé£é™©ç±» (4ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ daily_return.py           # æ—¥æ”¶ç›Šç‡ (<200è¡Œ)
â”‚   â”œâ”€â”€ cum_return.py             # ç´¯è®¡æ”¶ç›Šç‡ (<200è¡Œ)
â”‚   â”œâ”€â”€ annual_vol.py             # å¹´åŒ–æ³¢åŠ¨ç‡ (<200è¡Œ)
â”‚   â””â”€â”€ max_dd.py                 # æœ€å¤§å›æ’¤ (<200è¡Œ)
â”œâ”€â”€ utils/                        # å·¥å…·æ¨¡å— (æ¯ä¸ªæ–‡ä»¶<200è¡Œ)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ vectorized.py             # å‘é‡åŒ–è®¡ç®—å·¥å…· (<200è¡Œ)
â”‚   â”œâ”€â”€ performance.py            # æ€§èƒ½ç›‘æ§ (<200è¡Œ)
â”‚   â””â”€â”€ validation.py             # æ•°æ®éªŒè¯ (<200è¡Œ)
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ factors.yaml              # å› å­é…ç½®
â”‚   â”œâ”€â”€ cache.yaml                # ç¼“å­˜é…ç½®
â”‚   â””â”€â”€ data.yaml                 # æ•°æ®é…ç½®
â”œâ”€â”€ tests/                        # æµ‹è¯• (æ¯ä¸ªæ–‡ä»¶<200è¡Œ)
â”‚   â”œâ”€â”€ test_engine.py
â”‚   â”œâ”€â”€ test_cache.py
â”‚   â””â”€â”€ test_factors.py
â”œâ”€â”€ factor_data/                 # å› å­è¾“å‡ºç›®å½•  
â”‚   â”œâ”€â”€ single_factors/          # å•å› å­æ–‡ä»¶ (æ¨èæ–¹å¼)
â”‚   â”‚   â”œâ”€â”€ SMA_510580_SH.csv   # åŒ…å«SMA_5, SMA_10, SMA_20, SMA_60
â”‚   â”‚   â”œâ”€â”€ EMA_510580_SH.csv   # åŒ…å«EMA_5, EMA_10, EMA_20, EMA_60
â”‚   â”‚   â”œâ”€â”€ MACD_510580_SH.csv  # åŒ…å«MACD_DIF, MACD_DEA, MACD_HIST
â”‚   â”‚   â”œâ”€â”€ RSI_510580_SH.csv   # åŒ…å«RSI_6, RSI_14, RSI_24
â”‚   â”‚   â””â”€â”€ ... (25ä¸ªå•å› å­æ–‡ä»¶)
â”‚   â”œâ”€â”€ factor_groups/           # å› å­ç»„åˆæ–‡ä»¶ (å¯é€‰)
â”‚   â”‚   â”œâ”€â”€ moving_average_510580_SH.csv    # ç§»åŠ¨å‡çº¿ç±»5ä¸ªå› å­åˆå¹¶
â”‚   â”‚   â”œâ”€â”€ trend_momentum_510580_SH.csv    # è¶‹åŠ¿åŠ¨é‡ç±»4ä¸ªå› å­åˆå¹¶
â”‚   â”‚   â””â”€â”€ ... (5ä¸ªåˆ†ç»„æ–‡ä»¶)
â”‚   â”œâ”€â”€ complete/                # å®Œæ•´å› å­æ•°æ® (å¯é€‰)
â”‚   â”‚   â””â”€â”€ all_factors_510580_SH.csv      # å…¨éƒ¨25ä¸ªå› å­åˆå¹¶
â”‚   â””â”€â”€ cache/                   # ç¼“å­˜æ–‡ä»¶
â”‚       â”œâ”€â”€ factor_cache.pkl     # å› å­ç¼“å­˜
â”‚       â””â”€â”€ metadata.json        # å…ƒæ•°æ®
â”œâ”€â”€ examples/                     # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ basic_usage.py
â”‚   â”œâ”€â”€ incremental_update.py
â”‚   â””â”€â”€ performance_test.py
â””â”€â”€ docs/                         # æ–‡æ¡£
    â”œâ”€â”€ factor_list.md
    â”œâ”€â”€ architecture.md
    â””â”€â”€ vectorization_guide.md
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. BaseFactor (å‘é‡åŒ–å› å­åŸºç±») - 50è¡Œ
```python
class BaseFactor(ABC):
    """å‘é‡åŒ–å› å­åŸºç±» - æ¯ä¸ªå­ç±»<200è¡Œ"""
    
    def __init__(self, params: dict = None):
        self.params = params or {}
        self.name = self.__class__.__name__
        self.cache_key = None
    
    @abstractmethod  
    def calculate_vectorized(self, data: pd.DataFrame) -> pd.DataFrame:
        """å‘é‡åŒ–è®¡ç®— - å¿…é¡»ä½¿ç”¨NumPy/Pandaså‘é‡åŒ–æ“ä½œ"""
        pass
    
    def get_cache_key(self, data_hash: str) -> str:
        """ç”Ÿæˆç¼“å­˜é”®"""
        return f"{self.name}_{data_hash}_{hash(str(self.params))}"
```

### 2. VectorizedEngine (å‘é‡åŒ–å¼•æ“) - 180è¡Œ
```python
class VectorizedEngine:
    """å‘é‡åŒ–è®¡ç®—å¼•æ“"""
    
    def __init__(self):
        self.cache = CacheManager()
        self.data_loader = DataLoader()
        self.factors = self._discover_factors()
    
    def calculate_batch_vectorized(self, factor_names: list, 
                                  data: pd.DataFrame) -> pd.DataFrame:
        """æ‰¹é‡å‘é‡åŒ–è®¡ç®—"""
        # 1. æ£€æŸ¥ç¼“å­˜
        # 2. æ‰¹é‡å‘é‡åŒ–è®¡ç®—æœªç¼“å­˜å› å­  
        # 3. åˆå¹¶ç»“æœ
        # 4. æ›´æ–°ç¼“å­˜
        pass
    
    def calculate_incremental(self, new_data: pd.DataFrame):
        """å¢é‡æ›´æ–°è®¡ç®—"""
        pass
```

### 3. CacheManager (ç¼“å­˜ç®¡ç†å™¨) - 150è¡Œ  
```python
class CacheManager:
    """ç¼“å­˜ç®¡ç†å™¨ - æ”¯æŒå¢é‡æ›´æ–°"""
    
    def __init__(self, cache_dir="factor_data/cache"):
        self.cache_dir = cache_dir
        self.memory_cache = {}
        self.cache_file = f"{cache_dir}/factor_cache.pkl"
        self.metadata_file = f"{cache_dir}/metadata.json"
    
    def get_cached_factor(self, cache_key: str) -> pd.DataFrame:
        """è·å–ç¼“å­˜çš„å› å­"""
        pass
    
    def cache_factor(self, cache_key: str, result: pd.DataFrame):
        """ç¼“å­˜å› å­ç»“æœåˆ°å†…å­˜å’Œç£ç›˜"""
        pass
    
    def save_cache_to_disk(self):
        """ä¿å­˜ç¼“å­˜åˆ°ç£ç›˜"""
        pass
    
    def load_cache_from_disk(self):
        """ä»ç£ç›˜åŠ è½½ç¼“å­˜"""
        pass
```

### 4. DataWriter (æ•°æ®è¾“å‡ºå™¨) - 180è¡Œ
```python
class DataWriter:
    """æ•°æ®è¾“å‡ºç®¡ç†å™¨"""
    
    def __init__(self, output_dir="factor_data"):
        self.output_dir = output_dir
        self.ensure_directories()
    
    def save_single_factor(self, factor_name: str, data: pd.DataFrame, 
                          symbol="510580_SH"):
        """ä¿å­˜å•ä¸ªå› å­åˆ° single_factors/"""
        file_path = f"{self.output_dir}/single_factors/{factor_name}_{symbol}.csv"
        data.to_csv(file_path, index=False)
    
    def save_factor_group(self, group_name: str, data: pd.DataFrame,
                         symbol="510580_SH"):
        """ä¿å­˜å› å­ç»„åˆ° factor_groups/"""
        file_path = f"{self.output_dir}/factor_groups/{group_name}_{symbol}.csv"
        data.to_csv(file_path, index=False)
    
    def save_complete_factors(self, data: pd.DataFrame, symbol="510580_SH"):
        """ä¿å­˜å®Œæ•´å› å­æ•°æ®åˆ° complete/"""
        file_path = f"{self.output_dir}/complete/all_factors_{symbol}.csv"
        data.to_csv(file_path, index=False)
    
    def ensure_directories(self):
        """åˆ›å»ºè¾“å‡ºç›®å½•ç»“æ„"""
        dirs = ["single_factors", "factor_groups", "complete", "cache"]
        for dir_name in dirs:
            os.makedirs(f"{self.output_dir}/{dir_name}", exist_ok=True)
```

### 5. å•æ–‡ä»¶å› å­ç¤ºä¾‹ (SMA) - 120è¡Œ
```python  
import numpy as np
import pandas as pd
from src.base_factor import BaseFactor

class SMA(BaseFactor):
    """ç®€å•ç§»åŠ¨å‡çº¿ - å‘é‡åŒ–å®ç°"""
    
    def __init__(self, periods=[5, 10, 20, 60]):
        super().__init__({"periods": periods})
        
    def calculate_vectorized(self, data: pd.DataFrame) -> pd.DataFrame:
        """å‘é‡åŒ–è®¡ç®—SMA"""
        result = data[['ts_code', 'trade_date']].copy()
        
        # å‘é‡åŒ–è®¡ç®—æ‰€æœ‰å‘¨æœŸçš„SMA
        for period in self.params["periods"]:
            col_name = f'SMA_{period}'
            result[col_name] = data['hfq_close'].rolling(
                window=period, min_periods=1
            ).mean()
        
        return result
    
    def get_required_columns(self) -> list:
        return ['ts_code', 'trade_date', 'hfq_close']
```

---

## ğŸŒŠ æ•°æ®æµè®¾è®¡

```
1. æ•°æ®è¾“å…¥ (../data/)
   â”œâ”€â”€ 510580_SH_basic_data.csv     â†’ åŸºç¡€æ•°æ® + å¤æƒå› å­
   â”œâ”€â”€ 510580_SH_raw_data.csv       â†’ åŸå§‹äº¤æ˜“æ•°æ®  
   â”œâ”€â”€ 510580_SH_hfq_data.csv       â†’ åå¤æƒæ•°æ®
   â””â”€â”€ 510580_SH_qfq_data.csv       â†’ å‰å¤æƒæ•°æ®
                    â†“
2. æ•°æ®é¢„å¤„ç† (DataLoader)
   â”œâ”€â”€ æ•°æ®ç±»å‹è½¬æ¢ (date, float)
   â”œâ”€â”€ æ•°æ®è´¨é‡æ£€æŸ¥ (ç¼ºå¤±å€¼, å¼‚å¸¸å€¼)
   â”œâ”€â”€ æ•°æ®æ’åº (æŒ‰æ—¥æœŸ)
   â””â”€â”€ åˆ—åæ ‡å‡†åŒ–
                    â†“
3. ç¼“å­˜æ£€æŸ¥ (CacheManager)  
   â”œâ”€â”€ æ£€æŸ¥å› å­æ˜¯å¦å·²ç¼“å­˜
   â”œâ”€â”€ éªŒè¯æ•°æ®ä¸€è‡´æ€§
   â””â”€â”€ ç¡®å®šéœ€è¦è®¡ç®—çš„å› å­
                    â†“
4. å‘é‡åŒ–å› å­è®¡ç®— (VectorizedEngine)
   â”œâ”€â”€ ç§»åŠ¨å‡çº¿ç±»  â†’ ä½¿ç”¨ hfq_* å­—æ®µ
   â”œâ”€â”€ è¶‹åŠ¿åŠ¨é‡ç±»  â†’ ä½¿ç”¨ hfq_* å­—æ®µ  
   â”œâ”€â”€ æ³¢åŠ¨ç‡ç±»    â†’ ä½¿ç”¨ hfq_* å­—æ®µ
   â”œâ”€â”€ é‡ä»·å…³ç³»ç±»  â†’ ä½¿ç”¨ vol, amount å­—æ®µ
   â””â”€â”€ æ”¶ç›Šé£é™©ç±»  â†’ ä½¿ç”¨ hfq_* å­—æ®µ
                    â†“
5. ç»“æœç¼“å­˜ (CacheManager)
   â”œâ”€â”€ å†…å­˜ç¼“å­˜æ›´æ–°
   â”œâ”€â”€ ç£ç›˜ç¼“å­˜ä¿å­˜
   â””â”€â”€ å…ƒæ•°æ®æ›´æ–°
                    â†“
6. æ•°æ®è¾“å‡º (DataWriter â†’ factor_data/)
   â”œâ”€â”€ single_factors/    â†’ SMA_510580_SH.csv (ä¸€ä¸ªå› å­ä¸€ä¸ªæ–‡ä»¶)
   â”‚                        EMA_510580_SH.csv (ä¸€ä¸ªå› å­ä¸€ä¸ªæ–‡ä»¶)  
   â”‚                        MACD_510580_SH.csv (ä¸€ä¸ªå› å­ä¸€ä¸ªæ–‡ä»¶)
   â”‚                        ... (25ä¸ªç‹¬ç«‹æ–‡ä»¶)
   â”œâ”€â”€ factor_groups/     â†’ moving_average_510580_SH.csv (å¯é€‰åˆ†ç»„)
   â”œâ”€â”€ complete/          â†’ all_factors_510580_SH.csv (å¯é€‰å…¨é‡)
   â””â”€â”€ cache/             â†’ factor_cache.pkl (ç¼“å­˜æ–‡ä»¶)
```

---

## âš™ï¸ é…ç½®ç®¡ç†è®¾è®¡

### factor_config.yaml
```yaml
# å› å­å‚æ•°é…ç½®
moving_average:
  SMA:
    periods: [5, 10, 20, 60]
    data_type: "hfq"
  EMA:
    periods: [5, 10, 20, 60]
    data_type: "hfq"

trend_momentum:
  MACD:
    fast: 12
    slow: 26
    signal: 9
    data_type: "hfq"
  RSI:
    periods: [6, 14, 24]
    data_type: "hfq"
```

### data_config.yaml  
```yaml
# æ•°æ®æºé…ç½®
data_sources:
  basic_data: "../data/510580_SH_basic_data.csv"
  raw_data: "../data/510580_SH_raw_data.csv" 
  hfq_data: "../data/510580_SH_hfq_data.csv"
  qfq_data: "../data/510580_SH_qfq_data.csv"

data_columns:
  basic: ["ts_code", "trade_date", "open", "high", "low", "close", "vol", "amount", "adj_factor"]
  hfq: ["ts_code", "trade_date", "hfq_open", "hfq_high", "hfq_low", "hfq_close", "vol", "amount"]
  qfq: ["ts_code", "trade_date", "qfq_open", "qfq_high", "qfq_low", "qfq_close", "vol", "amount"]
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹è®¾è®¡

### å‘é‡åŒ–æ‰¹é‡è®¡ç®—
```python
from factor.src import VectorizedEngine

# 1. åˆ›å»ºå‘é‡åŒ–å¼•æ“
engine = VectorizedEngine()

# 2. æ‰¹é‡å‘é‡åŒ–è®¡ç®— (åˆ©ç”¨ç¼“å­˜)
factors = ["SMA", "EMA", "MACD", "RSI"]
result = engine.calculate_batch_vectorized(factors, use_cache=True)

# 3. å¢é‡æ›´æ–° (åªè®¡ç®—æ–°æ•°æ®)
new_data = engine.load_incremental_data("2025-09-06")
engine.calculate_incremental(new_data)
```

### å•æ–‡ä»¶å› å­å¼€å‘ (<200è¡Œ)
```python
# factors/custom_factor.py
import numpy as np
import pandas as pd
from src.base_factor import BaseFactor

class CustomFactor(BaseFactor):
    """è‡ªå®šä¹‰å› å­ - å‘é‡åŒ–å®ç° <200è¡Œ"""
    
    def __init__(self, param1=10, param2=20):
        super().__init__({"param1": param1, "param2": param2})
    
    def calculate_vectorized(self, data: pd.DataFrame) -> pd.DataFrame:
        """å¿…é¡»ä½¿ç”¨å‘é‡åŒ–è®¡ç®— - ç¦ç”¨å¾ªç¯"""
        result = data[['ts_code', 'trade_date']].copy()
        
        # å‘é‡åŒ–è®¡ç®—ç¤ºä¾‹
        result['CUSTOM'] = (
            data['hfq_close'].rolling(self.params['param1']).mean() /
            data['hfq_close'].rolling(self.params['param2']).mean()
        )
        
        return result
```

### ç¼“å­˜å’Œå¢é‡æ›´æ–°
```python
# é¦–æ¬¡è®¡ç®— - å…¨é‡è®¡ç®—å¹¶ç¼“å­˜+è¾“å‡º
result = engine.calculate_batch_vectorized(["SMA", "EMA"])
engine.save_factors(result, output_type="single")  # ä¿å­˜åˆ°factor_data/

# åç»­è®¡ç®— - ä»ç¼“å­˜åŠ è½½
cached_result = engine.calculate_batch_vectorized(["SMA", "EMA"])  # æé€Ÿ

# æ–°æ•°æ®åˆ°è¾¾ - å¢é‡æ›´æ–°+è¾“å‡º
engine.add_new_data("2025-09-06", new_row_data)
updated_result = engine.get_latest_factors(["SMA", "EMA"])
engine.save_incremental_update(updated_result)  # å¢é‡ä¿å­˜

# æ‰¹é‡è¾“å‡ºæ‰€æœ‰å› å­
all_factors = engine.calculate_all_factors()
engine.save_complete_dataset(all_factors)  # ä¿å­˜åˆ°factor_data/complete/
```

---

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### 1. æ–°å¢å› å­æµç¨‹
1. åœ¨å¯¹åº”åˆ†ç±»ç›®å½•åˆ›å»ºå› å­æ–‡ä»¶
2. ç»§æ‰¿BaseFactoråŸºç±»
3. å®ç°calculateæ–¹æ³•
4. ä½¿ç”¨@FactorFactory.registerè£…é¥°å™¨æ³¨å†Œ
5. æ›´æ–°é…ç½®æ–‡ä»¶

### 2. æ–°å¢æ•°æ®æº
1. åœ¨DataLoaderä¸­æ·»åŠ æ–°çš„æ•°æ®åŠ è½½æ–¹æ³•
2. æ›´æ–°data_config.yamlé…ç½®
3. æ·»åŠ æ•°æ®éªŒè¯é€»è¾‘

### 3. æ€§èƒ½ä¼˜åŒ–ç‚¹
- æ•°æ®ç¼“å­˜æœºåˆ¶
- å¹¶è¡Œè®¡ç®—æ”¯æŒ
- å¢é‡æ›´æ–°æ”¯æŒ
- å†…å­˜ä¼˜åŒ– (åˆ†å—å¤„ç†)

---

## ğŸ“‹ å¼€å‘è®¡åˆ’

### Phase 1: å‘é‡åŒ–æ ¸å¿ƒæ¡†æ¶ (1-2å¤©)
- [ ] BaseFactorå‘é‡åŒ–åŸºç±» (<50è¡Œ)
- [ ] VectorizedEngineè®¡ç®—å¼•æ“ (<180è¡Œ) 
- [ ] CacheManagerç¼“å­˜ç®¡ç†å™¨ (<150è¡Œ)
- [ ] DataLoaderæ•°æ®åŠ è½½å™¨ (<200è¡Œ)
- [ ] DataWriteræ•°æ®è¾“å‡ºå™¨ (<180è¡Œ)
- [ ] å‘é‡åŒ–å·¥å…·å‡½æ•° (<200è¡Œ)

### Phase 2: 25ä¸ªå› å­å®ç° (3-4å¤©ï¼Œæ¯ä¸ªæ–‡ä»¶<200è¡Œ)
- [ ] ç§»åŠ¨å‡çº¿ç±»: sma.py, ema.py, wma.py, ma_diff.py, ma_slope.py
- [ ] è¶‹åŠ¿åŠ¨é‡ç±»: macd.py, rsi.py, roc.py, mom.py  
- [ ] æ³¢åŠ¨ç‡ç±»: tr.py, atr.py, atr_pct.py, hv.py, boll.py, dc.py, bb_width.py, stoch.py
- [ ] é‡ä»·å…³ç³»ç±»: vma.py, volume_ratio.py, obv.py, kdj.py, cci.py, wr.py, mfi.py
- [ ] æ”¶ç›Šé£é™©ç±»: daily_return.py, cum_return.py, annual_vol.py, max_dd.py

### Phase 3: æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯• (1-2å¤©)
- [ ] å‘é‡åŒ–æ€§èƒ½æµ‹è¯•
- [ ] ç¼“å­˜æ•ˆç‡æµ‹è¯•
- [ ] å¢é‡æ›´æ–°æµ‹è¯•  
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–

---

## âœ… æ¶æ„æ€»ç»“

### æ ¸å¿ƒç‰¹ç‚¹
1. **å‘é‡åŒ–è®¡ç®—**: å…¨éƒ¨ä½¿ç”¨NumPy/Pandaså‘é‡åŒ–æ“ä½œ
2. **æ–‡ä»¶é™åˆ¶**: æ¯ä¸ªæ–‡ä»¶ä¸¥æ ¼<200è¡Œï¼Œå•ä¸€èŒè´£
3. **ç¼“å­˜æœºåˆ¶**: æ”¯æŒå¢é‡æ›´æ–°ï¼Œé¿å…é‡å¤è®¡ç®—
4. **å•æ–‡ä»¶å› å­**: æ¯ä¸ªå› å­ä¸€ä¸ª.pyæ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤
5. **æ ‡å‡†åŒ–æ¥å£**: ç»Ÿä¸€çš„BaseFactoråŸºç±»

### å›ç­”æ‚¨çš„é—®é¢˜
**Q: æ¯ä¸€ä¸ªå› å­å°±ä¸€ä¸ªpyå¤Ÿå—è¿˜æ˜¯éœ€è¦ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Ÿ**
**A: ä¸€ä¸ª.pyæ–‡ä»¶å¤Ÿäº†ï¼**
- æ¯ä¸ªå› å­åŠŸèƒ½å•ä¸€ï¼Œ<200è¡Œå®Œå…¨å¤Ÿç”¨
- æ–‡ä»¶å¤¹ä¼šå¢åŠ å¤æ‚åº¦ï¼Œå•æ–‡ä»¶æ›´ç®€æ´
- 25ä¸ªå› å­ = 25ä¸ª.pyæ–‡ä»¶ï¼Œæ¸…æ™°æ˜äº†

### æ€§èƒ½ä¼˜åŠ¿  
- **å‘é‡åŒ–**: æ¯”å¾ªç¯å¿«10-100å€
- **ç¼“å­˜**: äºŒæ¬¡è®¡ç®—æ¥è¿‘0è€—æ—¶
- **å¢é‡**: æ–°æ•°æ®åªè®¡ç®—å¢é‡éƒ¨åˆ†
- **æ‰¹é‡**: ä¸€æ¬¡æ€§è®¡ç®—å¤šä¸ªå› å­

*å‘é‡åŒ–å› å­åº“æ¶æ„ v2.0 | 25ä¸ªå•æ–‡ä»¶å› å­ | ç¼“å­˜+å¢é‡æ›´æ–°*