# ICå› å­é€‰æ‹©ç³»ç»ŸæŠ€æœ¯è§„èŒƒ

## ðŸ“‹ ç³»ç»Ÿæ¦‚è¿°

IC (Information Coefficient) å› å­é€‰æ‹©ç³»ç»Ÿæ˜¯é‡åŒ–äº¤æ˜“æ¡†æž¶çš„æ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºŽè¯„ä¼°å’Œç­›é€‰ä¼˜è´¨å› å­ã€‚ç³»ç»Ÿé‡‡ç”¨ç§‘å­¦çš„è¯„åˆ†æœºåˆ¶å’Œä¸¥æ ¼çš„é‡‘èžå·¥ç¨‹æ ‡å‡†ï¼Œä¸ºç­–ç•¥å¼€å‘æä¾›å¯é çš„å› å­åŸºç¡€ã€‚

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

### æ ¸å¿ƒç»„ä»¶
```
analyzers/ic/
â”œâ”€â”€ core.py              # ICè®¡ç®—æ ¸å¿ƒå¼•æ“Ž
â”œâ”€â”€ fast_core.py         # å‘é‡åŒ–å¿«é€Ÿè®¡ç®—å¼•æ“Ž
â”œâ”€â”€ analyzer.py          # é«˜çº§åˆ†æžå™¨
â””â”€â”€ __init__.py          # ç»Ÿä¸€æŽ¥å£
```

### æŠ€æœ¯ç‰¹ç‚¹
- **å‘é‡åŒ–è®¡ç®—**ï¼šåŸºäºŽPandas/NumPyï¼Œæ€§èƒ½æå‡10-100å€
- **å¤šçª—å£åˆ†æž**ï¼šæ”¯æŒçŸ­çº¿åˆ°ä¸­çº¿çš„å¤šæ—¶é—´æ¡†æž¶
- **åŒæ¨¡å¼è¿è¡Œ**ï¼šå¿«é€Ÿæ¨¡å¼(å‘é‡åŒ–) + æ ‡å‡†æ¨¡å¼(é€æ­¥è®¡ç®—)
- **é‡‘èžæ ‡å‡†**ï¼šä¸¥æ ¼éµå¾ªé‡åŒ–ç ”ç©¶è¡Œä¸šè§„èŒƒ

## ðŸ“Š ICè®¡ç®—åŽŸç†

### 1. ICå€¼å®šä¹‰
ä¿¡æ¯ç³»æ•°(IC)è¡¡é‡å› å­é¢„æµ‹èƒ½åŠ›ï¼Œè®¡ç®—å› å­å€¼ä¸Žæœªæ¥æ”¶ç›Šçš„ç›¸å…³æ€§ï¼š

```python
IC = correlation(factor_t, return_{t+k})
```

- `factor_t`: tæ—¶åˆ»çš„å› å­å€¼
- `return_{t+k}`: t+kæ—¶åˆ»çš„å‰çž»æ”¶ç›ŠçŽ‡
- `k`: å‰çž»æœŸæ•°(é€šå¸¸ä¸º1, 3, 5, 10æ—¥)

### 2. è®¡ç®—æ–¹æ³•
æ”¯æŒä¸¤ç§ç›¸å…³æ€§è®¡ç®—ï¼š
- **Pearsonç›¸å…³ç³»æ•°**ï¼šè¡¡é‡çº¿æ€§å…³ç³»å¼ºåº¦
- **Spearmanç›¸å…³ç³»æ•°**ï¼šè¡¡é‡å•è°ƒå…³ç³»å¼ºåº¦(å¯¹å¼‚å¸¸å€¼æ›´é²æ£’)

### 3. æ»šåŠ¨ICè®¡ç®—
ä½¿ç”¨æ»šåŠ¨çª—å£è®¡ç®—ICæ—¶é—´åºåˆ—ï¼Œè¯„ä¼°å› å­ç¨³å®šæ€§ï¼š
```python
IC_rolling = factor.rolling(window).corr(future_returns)
```

## âš™ï¸ ç³»ç»Ÿé…ç½®

### çª—å£é…ç½®ç­–ç•¥
ç³»ç»Ÿæ”¯æŒ5ç§é¢„å®šä¹‰ç­–ç•¥ï¼š

| ç­–ç•¥ç±»åž‹ | ICçª—å£ | ä¸»çª—å£ | ç¨³å®šæ€§çª—å£ | é€‚ç”¨åœºæ™¯ |
|---------|-------|-------|----------|----------|
| **short_term** | [10,20,30] | 20æ—¥ | 20æ—¥ | ETFæ‹©æ—¶çŸ­çº¿(æŽ¨è) |
| ultra_short | [5,10,15] | 10æ—¥ | 15æ—¥ | æ—¥å†…åˆ°å‘¨çº§äº¤æ˜“ |
| medium_short | [15,30,45] | 30æ—¥ | 30æ—¥ | æœˆçº§åˆ«äº¤æ˜“ |
| medium_term | [30,60,90] | 60æ—¥ | 60æ—¥ | å­£åº¦çº§äº¤æ˜“ |
| multi_timeframe | [10,20,30,60] | 20æ—¥ | 30æ—¥ | å…¨æ—¶é—´æ¡†æž¶åˆ†æž |

### å…³é”®å‚æ•°è®¾ç½®
```python
# æœ€å°è®¡ç®—æœŸæ•°ï¼ˆé‡‘èžæ ‡å‡†ï¼‰
min_periods = 20  # è‡³å°‘20ä¸ªäº¤æ˜“æ—¥

# å‰çž»æœŸè®¾ç½®
forward_periods = [1, 3, 5, 10]  # 1æ—¥ã€3æ—¥ã€5æ—¥ã€10æ—¥å‰çž»

# æ•°æ®è´¨é‡è¦æ±‚
min_data_length = window + forward_periods + min_periods
```

## ðŸ” å› å­è¯„ä¼°ä½“ç³»

### ICç»Ÿè®¡æŒ‡æ ‡

#### 1. æ ¸å¿ƒæŒ‡æ ‡
- **ICå‡å€¼ (ic_mean)**ï¼šå¹³å‡é¢„æµ‹èƒ½åŠ›
- **ICæ ‡å‡†å·® (ic_std)**ï¼šé¢„æµ‹ç¨³å®šæ€§
- **ICä¿¡æ¯æ¯”çŽ‡ (ic_ir)**ï¼šé£Žé™©è°ƒæ•´åŽçš„é¢„æµ‹èƒ½åŠ›
  ```python
  ic_ir = ic_mean / ic_std
  ```
- **ICèƒœçŽ‡ (ic_positive_ratio)**ï¼šé¢„æµ‹æ–¹å‘æ­£ç¡®çš„æ¯”ä¾‹
- **ICç»å¯¹å€¼å‡å€¼ (ic_abs_mean)**ï¼šé¢„æµ‹å¼ºåº¦(ä¸è€ƒè™‘æ–¹å‘)

#### 2. è¾…åŠ©æŒ‡æ ‡
- **æ ·æœ¬æ•°é‡ (sample_size)**ï¼šæœ‰æ•ˆè®¡ç®—æ ·æœ¬æ•°
- **ICæœ€å¤§å€¼/æœ€å°å€¼**ï¼šæžå€¼åˆ†æž

### å› å­è¯„åˆ†ç®—æ³•

#### è¯„åˆ†æƒé‡ç»“æž„
```python
æ€»åˆ† = ICè¡¨çŽ°(60%) + ç¨³å®šæ€§(25%) + æ•°æ®è´¨é‡(10%) + åˆ†å¸ƒåˆç†æ€§(5%)
```

#### ICè¡¨çŽ°è¯„åˆ† (60%æƒé‡)
```python
ICè¡¨çŽ°åˆ† = é¢„æµ‹å¼ºåº¦(50%) + ICç¨³å®šæ€§(30%) + æ–¹å‘æ€§(20%)
```

##### 1. é¢„æµ‹å¼ºåº¦è¯„åˆ† (åŸºäºŽic_abs_mean)
```python
if ic_abs_mean >= 0.08:     # Açº§ï¼šä¼˜ç§€å› å­
    score = 1.0
elif ic_abs_mean >= 0.05:   # Bçº§ï¼šè‰¯å¥½å› å­
    score = 0.7 + (ic_abs_mean - 0.05) / 0.03 * 0.3
elif ic_abs_mean >= 0.03:   # Cçº§ï¼šå¯ç”¨å› å­
    score = 0.4 + (ic_abs_mean - 0.03) / 0.02 * 0.3
elif ic_abs_mean >= 0.02:   # Dçº§ï¼šè¾ƒå¼±å› å­
    score = 0.2 + (ic_abs_mean - 0.02) / 0.01 * 0.2
else:                       # Fçº§ï¼šæ— æ•ˆå› å­
    score = ic_abs_mean / 0.02 * 0.2
```

##### 2. ICä¿¡æ¯æ¯”çŽ‡è¯„åˆ† (åŸºäºŽic_ir)
```python
if abs(ic_ir) >= 1.0:       # éžå¸¸ä¼˜ç§€ (IR>1.0)
    score = 1.0
elif abs(ic_ir) >= 0.5:     # è¾ƒä¼˜ç§€ (IR>0.5)
    score = 0.5 + (abs(ic_ir) - 0.5) / 0.5 * 0.5
else:                       # ä¸€èˆ¬ (IR<0.5)
    score = abs(ic_ir) / 0.5 * 0.5
```

##### 3. æ–¹å‘æ€§è¯„åˆ† (åŸºäºŽic_positive_ratio)
```python
if ic_positive_ratio >= 0.6:           # é«˜èƒœçŽ‡
    score = 0.5 + (ic_positive_ratio - 0.6) / 0.4 * 0.5
elif ic_positive_ratio <= 0.4:         # ä½ŽèƒœçŽ‡(åå‘æœ‰æ•ˆ)
    score = 0.5 + (0.4 - ic_positive_ratio) / 0.4 * 0.5
else:                                   # æŽ¥è¿‘50%(æ–¹å‘æ€§ä¸æ˜Žç¡®)
    score = (0.5 - abs(ic_positive_ratio - 0.5)) / 0.1 * 0.5
```

#### ç¨³å®šæ€§è¯„åˆ† (25%æƒé‡)
```python
# åŸºç¡€ç¨³å®šæ€§
base_stability = stability_stats['stability_score']

# ICç¨³å®šæ€§æƒ©ç½š
ic_cv = ic_std / abs(ic_mean)  # å˜å¼‚ç³»æ•°
ic_stability_penalty = min(0.5, ic_cv / 2.0)

# æœ€ç»ˆç¨³å®šæ€§è¯„åˆ†
stability_score = max(0.0, base_stability - ic_stability_penalty) * 0.25
```

#### æ•°æ®è´¨é‡è¯„åˆ† (10%æƒé‡)
```python
data_quality_score = (1 - missing_ratio) * 0.1
```

#### åˆ†å¸ƒåˆç†æ€§è¯„åˆ† (5%æƒé‡)
```python
if abs(skewness) < 2 and abs(kurtosis) < 7:  # æŽ¥è¿‘æ­£æ€åˆ†å¸ƒ
    distribution_score = 0.1
else:
    distribution_score = 0.05
```

## ðŸ† å› å­è¯„çº§ä½“ç³»

### è¯„çº§æ ‡å‡†
åŸºäºŽæ€»åˆ†è¿›è¡Œä¸¥æ ¼åˆ†çº§ï¼Œç›®æ ‡åˆ†å¸ƒï¼šAçº§5%ï¼ŒBçº§20%ï¼ŒCçº§50%ï¼ŒDçº§15%ï¼ŒFçº§10%

| è¯„çº§ | åˆ†æ•°èŒƒå›´ | æè¿° | ä½¿ç”¨å»ºè®® | ç½®ä¿¡åº¦ |
|------|----------|------|----------|---------|
| **A** | â‰¥75åˆ† | ä¼˜ç§€å› å­ | æ ¸å¿ƒç­–ç•¥å› å­ | é«˜ |
| **B** | 65-75åˆ† | è‰¯å¥½å› å­ | ä¸»è¦ç­–ç•¥å› å­ | ä¸­é«˜ |
| **C** | 45-65åˆ† | å¯ç”¨å› å­ | è¾…åŠ©ç­–ç•¥å› å­ | ä¸­ç­‰ |
| **D** | 35-45åˆ† | è¾ƒå¼±å› å­ | è°¨æ…Žä½¿ç”¨ | ä½Ž |
| **F** | <35åˆ† | æ— æ•ˆå› å­ | ä¸å»ºè®®ä½¿ç”¨ | æžä½Ž |

### å¼ºåˆ¶é™çº§æœºåˆ¶
å³ä½¿æ€»åˆ†è¾¾æ ‡ï¼Œä»¥ä¸‹æƒ…å†µå°†å¼ºåˆ¶é™çº§ï¼š

#### 1. ICå¼ºåº¦ç­›é€‰
```python
if ic_abs_mean < 0.005:                    # å¼ºåˆ¶Fçº§
    grade = 'F'
elif ic_abs_mean < 0.02 and grade in ['A', 'B']:  # é€‚åº¦é™çº§
    grade = 'C'
elif ic_abs_mean < 0.03 and grade == 'A': # Açº§é™ä¸ºBçº§
    grade = 'B'
```

#### 2. æ•°æ®é•¿åº¦éªŒè¯
```python
if sample_size < 250:                      # å°‘äºŽ1å¹´æ•°æ®
    if grade == 'A':
        grade = 'B'                        # Açº§é™ä¸ºBçº§
elif sample_size < 375:                    # å°‘äºŽ1.5å¹´æ•°æ®
    if grade == 'A' and ic_abs_mean < 0.06:
        grade = 'B'                        # è°¨æ…Žé™çº§
```

## ðŸš€ è®¡ç®—æ€§èƒ½ä¼˜åŒ–

### å¿«é€Ÿæ¨¡å¼ç‰¹æ€§
å¯ç”¨`fast_mode=True`æ—¶ï¼Œç³»ç»Ÿä½¿ç”¨å‘é‡åŒ–ç®—æ³•ï¼š

#### 1. å‘é‡åŒ–ICè®¡ç®—
```python
# ä¼ ç»Ÿå¾ªçŽ¯è®¡ç®— -> å‘é‡åŒ–è®¡ç®—
rolling_ic = factor_values.rolling(window=window).corr(future_returns)
```

#### 2. æ‰¹é‡å¤šçª—å£è®¡ç®—
```python
# ä¸€æ¬¡æ€§æ•°æ®å¯¹é½ï¼Œé¿å…é‡å¤å¤„ç†
aligned_data = pd.concat([factor_data, returns], axis=1, join='inner').dropna()
future_returns = aligned_data.iloc[:, 1].shift(-forward_periods)

# æ‰¹é‡è®¡ç®—æ‰€æœ‰çª—å£
for window in windows:
    rolling_ic = factor_values.rolling(window=window).corr(future_returns)
```

#### 3. æ€§èƒ½æå‡
- **è®¡ç®—é€Ÿåº¦**ï¼šå‘é‡åŒ–æ“ä½œæå‡10-100å€
- **å†…å­˜æ•ˆçŽ‡**ï¼šå‡å°‘é‡å¤æ•°æ®å¤åˆ¶
- **CPUåˆ©ç”¨çŽ‡**ï¼šå……åˆ†åˆ©ç”¨NumPyä¼˜åŒ–

## ðŸ“ˆ å®žé™…åº”ç”¨æ¡ˆä¾‹

### ä½¿ç”¨ç¤ºä¾‹
```python
from quant_trading.analyzers.ic import ICAnalyzer

# åˆå§‹åŒ–åˆ†æžå™¨(çŸ­çº¿ç­–ç•¥é…ç½®)
analyzer = ICAnalyzer(
    min_periods=20,
    strategy_type='short_term',
    fast_mode=True
)

# åˆ†æžå•ä¸ªå› å­
results = analyzer.analyze_factor_ic(factor_series, returns)

# æ‰¹é‡åˆ†æžæ‰€æœ‰å› å­
all_results = analyzer.analyze_all_factors(factor_dataframe, returns)

# å› å­æŽ’åº
ranking = analyzer.rank_factors_by_ic(all_results, period=1, metric='ic_ir')
```

### è¾“å‡ºç»“æžœç»“æž„
```python
{
    'factor_name': 'SMA_5',
    'strategy_type': 'short_term',
    'window_config': {
        'ic_windows': [10, 20, 30],
        'primary_window': 20,
        'description': 'çŸ­çº¿ç­–ç•¥ï¼šé€‚åˆ1-4å‘¨äº¤æ˜“å‘¨æœŸ'
    },
    'ic_analysis': {
        'period_1': {
            'ic_pearson': 0.045,
            'ic_spearman': 0.052
        }
    },
    'statistics': {
        'period_1': {
            'ic_mean': 0.043,
            'ic_std': 0.156,
            'ic_ir': 0.276,
            'ic_positive_ratio': 0.54,
            'ic_abs_mean': 0.089
        }
    }
}
```

## ðŸ”¬ é‡‘èžå·¥ç¨‹æ ‡å‡†

### è®¡ç®—æ ‡å‡†ä¾æ®
1. **ICè®¡ç®—**ï¼šä¸¥æ ¼æŒ‰ç…§é‡‘èžå·¥ç¨‹æ ‡å‡†å®žçŽ°
2. **å‰çž»æœŸè®¾å®š**ï¼šç¬¦åˆé‡åŒ–ç ”ç©¶æƒ¯ä¾‹
3. **æ»šåŠ¨çª—å£**ï¼šä½¿ç”¨20æ—¥çŸ­çº¿æ ‡å‡†çª—å£
4. **ç›¸å…³æ€§é˜ˆå€¼**ï¼šé‡‡ç”¨è¡Œä¸šæ ‡å‡†æ–¹æ³•

### é£Žé™©æŽ§åˆ¶
1. **æ•°æ®éªŒè¯**ï¼šä¸¥æ ¼çš„è¾“å…¥æ•°æ®æ ¡éªŒ
2. **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. **è¾¹ç•Œæ£€æŸ¥**ï¼šé˜²æ­¢è®¡ç®—æº¢å‡ºå’Œæ— æ•ˆç»“æžœ
4. **ä¸€è‡´æ€§ä¿è¯**ï¼šç¡®ä¿è®¡ç®—ç»“æžœçš„å¯é‡çŽ°æ€§

## ðŸŽ¯ è´¨é‡ä¿è¯

### å•å…ƒæµ‹è¯•è¦†ç›–
- ICè®¡ç®—å‡†ç¡®æ€§éªŒè¯
- ä¸Žscipyè®¡ç®—ç»“æžœå¯¹æ¯”
- è¾¹ç•Œæ¡ä»¶å¤„ç†æµ‹è¯•
- å¤§è§„æ¨¡æ•°æ®æ€§èƒ½éªŒè¯

### é‡‘èžåˆç†æ€§éªŒè¯
- å¼ºç›¸å…³å› å­åº”äº§ç”Ÿé«˜ICå€¼
- ICç»Ÿè®¡é‡åº”ç¬¦åˆé‡‘èžç›´è§‰
- è¯„åˆ†æœºåˆ¶åº”ä½“çŽ°å®žé™…é¢„æµ‹èƒ½åŠ›

## âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹

### æ•°æ®è¦æ±‚
- **æœ€å°æ ·æœ¬é‡**ï¼šè‡³å°‘20ä¸ªæœ‰æ•ˆè§‚æµ‹å€¼è¿›è¡ŒICè®¡ç®—
- **æ•°æ®å®Œæ•´æ€§**ï¼šç¼ºå¤±çŽ‡ä¸è¶…è¿‡20%
- **æ—¶é—´è·¨åº¦**ï¼šå»ºè®®è‡³å°‘2å¹´åŽ†å²æ•°æ®
- **æ•°æ®é¢‘çŽ‡**ï¼šæ—¥é¢‘æ•°æ®ï¼Œéžäº¤æ˜“æ—¥å·²å‰”é™¤

### ç»“æžœè§£è¯»
- **ICç»å¯¹å€¼**ï¼š>0.05ä¸ºæœ‰æ•ˆå› å­ï¼Œ>0.08ä¸ºä¼˜ç§€å› å­
- **ICä¿¡æ¯æ¯”çŽ‡**ï¼š>0.5ä¸ºè¾ƒå¥½å› å­ï¼Œ>1.0ä¸ºä¼˜ç§€å› å­
- **ICèƒœçŽ‡**ï¼š>60%æˆ–<40%è¡¨æ˜Žæ–¹å‘æ€§æ˜Žç¡®
- **æ ·æœ¬é‡**ï¼š<250ä¸ªæ ·æœ¬çš„ç»“æžœéœ€è°¨æ…Žå¯¹å¾…

### å±€é™æ€§
- ICä»…è¡¡é‡çº¿æ€§/å•è°ƒå…³ç³»ï¼Œæ— æ³•æ•æ‰å¤æ‚éžçº¿æ€§å…³ç³»
- åŽ†å²ICè¡¨çŽ°ä¸ä¿è¯æœªæ¥æœ‰æ•ˆæ€§
- éœ€è¦ç»“åˆå…¶ä»–æŒ‡æ ‡è¿›è¡Œç»¼åˆè¯„ä¼°
- å¸‚åœºçŽ¯å¢ƒå˜åŒ–å¯èƒ½å½±å“å› å­æœ‰æ•ˆæ€§

---

**å…è´£å£°æ˜Ž**ï¼šæœ¬ç³»ç»Ÿä»…ç”¨äºŽé‡åŒ–ç ”ç©¶å’Œæ•™è‚²ç›®çš„ï¼Œä¸æž„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚ICåˆ†æžç»“æžœåŸºäºŽåŽ†å²æ•°æ®ï¼Œä¸ä»£è¡¨æœªæ¥è¡¨çŽ°ã€‚å®žé™…ä½¿ç”¨æ—¶è¯·ç»“åˆå¤šç§åˆ†æžæ–¹æ³•å¹¶è°¨æ…Žå†³ç­–ã€‚